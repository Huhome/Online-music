import{s as t,u as i,x as e,y as s,o as a,c as l,w as c,a as n,b as o,e as r,q as m,v as u,n as d,d as g,r as h,F as f,z as k,k as p,t as y,i as _,g as L,l as x,h as b,A as v,B as C}from"./index.bf2feab7.js";import{_ as I,m as T}from"./musichead.b8bd4ef4.js";import{a as D,_ as w}from"./sq.b146fc49.js";var $=I({props:{id:Number},data:()=>({dateilList:{},simiList:[],commentList:[],geciList:[],songList:{},lyricIndex:0,mucik:{},musckflag:!0,timer:0,isShow:!1,CirculationMode:["icon-caozuo-xunhuan1","icon-suijisenlin","icon-caozuo-xunhuan1"],Circulationitem:"icon-caozuo-xunhuan1",playflag:!1,playActive:0,geciFlag:!0,slider:{currentTime:"00:00",endTimer:"00:00",sliderValue:0,endValue:0,timer:0},comptimer:{currentTime:0},iconflag:!0,likeflag:!1,commentflag:!1}),onShow(){this.playActive=parseInt(this.id),this.getdateilList(),this.getcommentList(),this.getsimiList(),this.getgeciList(),this.getsongList()},onHide(){clearInterval(this.slider.timer),clearInterval(this.timer),this.mucik.stop()},onUnload(){clearInterval(this.slider.timer),clearInterval(this.timer),this.mucik.stop()},computed:{nextID:()=>t.state.nextID,topID:()=>t.state.topID,micskLength:()=>t.state.micskLength},methods:{async getdateilList(){const t=await this.$axios({url:`/song/detail?ids=${this.playActive}`});if(200!==t.code)return i({title:"网络服务异常~",icon:"error",mask:!0});this.dateilList=t.songs[0],this.slider.timer=t.songs[0].dt},async getsimiList(){const t=await this.$axios({url:`/simi/song?id=${this.playActive}`});if(200!==t.code)return i({title:"网络服务异常~",icon:"error",mask:!0});this.simiList=t.songs},async getcommentList(){const t=await this.$axios({url:`/comment/music?id=${this.playActive}`});if(200!==t.code)return i({title:"网络服务异常~",icon:"error",mask:!0});this.commentList=t.hotComments},async getgeciList(){const t=await this.$axios({url:`/lyric?id=${this.playActive}`});if(200!==t.code)return i({title:"网络服务异常~",icon:"error",mask:!0});let e=t.lrc.lyric,s=[];e.replace(/\[([^\]]+)\]([^\[]+)/g,((t,i,e)=>{s.push({time:this.formatTimeToSec(i),lyric:e})})),this.geciList=s},async getsongList(){const a=await this.$axios({url:`/song/url?id=${this.playActive}`});if(200!==a.code)return i({title:"网络服务异常~",icon:"error",mask:!0});t.commit("GetnextID",this.playActive),this.mucik=e(),this.mucik.autoplay=!0,this.mucik.src=a.data[0].url||"",this.mucik.onPlay((()=>{this.startTimer(),this.listengeciIndex(),this.slider.endTimer=this.getTime(this.mucik.duration),this.musckflag=this.mucik.paused,this.slider.endValue=parseInt(this.mucik.duration)})),this.mucik.onPause((()=>{clearInterval(this.slider.timer),this.musckflag=this.mucik.paused,clearInterval(this.timer)})),this.isShow=!0,this.mucik.onEnded((()=>{s({url:`/pages/dateil/dateil?id=${t.state.nextID}`})}))},formatTimeToSec(t){let i=t.split(":");return 60*parseFloat(i[0])+parseFloat(parseFloat(i[1]).toFixed(1))},clickmusck(){if(this.musckflag)return this.mucik.play();this.mucik.pause()},listengeciIndex(){clearInterval(this.timer),this.timer=setInterval((()=>{for(var t=0;t<this.geciList.length;t++){if(this.mucik.currentTime>=this.geciList[this.geciList.length-1].time){this.lyricIndex=this.geciList.length-1;break}if(this.mucik.currentTime>=this.geciList[t].time&&this.mucik.currentTime<this.geciList[t+1].time){this.lyricIndex=t;break}}}),100)},topmscik(){this.detailLikeList(this.simiList[0].id)},deleteSong(i){t.commit("deleteSong",i),this.playActive===i?(this.mucik.stop(),this.redireSong(t.state.nextID)):i!==t.state.nextID&&i!==this.topID||t.commit("GetnextID",this.playActive)},Changesong(i,e){1===i?(this.mucik.stop(),this.redireSong(t.state.topID)):2===i?(this.mucik.stop(),this.redireSong(t.state.nextID)):3===i&&(this.mucik.stop(),this.redireSong(e))},redireSong(t){this.playActive=parseInt(t)||parseInt(this.id),this.getdateilList(),this.getcommentList(),this.getsimiList(),this.getgeciList(),this.getsongList()},Bootapp(){i({title:"请切换至app",duration:800})},changeProgress(t){const i=t.detail.value;this.comptimer.currentTime=i,this.slider.currentTime=this.getTime(this.comptimer.currentTime),this.mucik.seek(this.comptimer.currentTime)},startTimer(){return this.slider.timer=setInterval((()=>{this.comptimer.currentTime++,this.slider.currentTime=this.getTime(this.comptimer.currentTime),this.slider.sliderValue=this.comptimer.currentTime}),1e3),1},detailLikeList(i){let e=[];this.simiList.filter((t=>{e.push({id:t.id,name:t.name,ar:[{name:t.artists[0].name}]})})),t.commit("likeList",e),this.redireSong(i)},getTime(t,i){let e=0,s=0,a=0;return t>=3600&&(e=parseInt(t/3600,10),t-=3600*e),s=parseInt(t/60,10),a=parseInt(t-60*s,10),i?`${this.getTimeData(e)}:${this.getTimeData(s)}:${this.getTimeData(a)}`:`${this.getTimeData(s)}:${this.getTimeData(a)}`},getTimeData:t=>t>=10?t:"0"+t,stop(){}},components:{musichead:T}},[["render",function(t,i,e,s,I,T){const $=_,F=L("musichead"),S=x,A=b,j=v,z=C;return a(),l($,{class:"dateil"},{default:c((()=>[I.dateilList.al?(a(),l($,{key:0,class:"dateil-bg",style:n({"background-image":`url(${I.dateilList.al.picUrl})`})},null,8,["style"])):o("",!0),r(F,{title:I.dateilList.name,flag:!0,color:"white"},null,8,["title"]),m(r($,{class:"dateil-cont",onClick:i[3]||(i[3]=t=>I.geciFlag=!I.geciFlag)},{default:c((()=>[m(r($,{class:"datail-play"},{default:c((()=>[I.dateilList.al?(a(),l(S,{key:0,class:d({run:!I.musckflag}),src:I.dateilList.al.picUrl,mode:"widthFix"},null,8,["class","src"])):o("",!0),r($,{class:""})])),_:1},512),[[u,I.geciFlag]]),m(r($,{class:"dateil-geci"},{default:c((()=>[r($,{class:"geci-cont",style:n({transform:"translateY("+82*-(I.lyricIndex-1)+"rpx)"})},{default:c((()=>[(a(!0),g(f,null,h(I.geciList,((t,i)=>(a(),l($,{class:d(["geci-item",i===I.lyricIndex?"active":""]),key:i},{default:c((()=>[p(y(t.lyric),1)])),_:2},1032,["class"])))),128))])),_:1},8,["style"]),r($,{class:"geci-ppr"})])),_:1},512),[[u,!I.geciFlag]]),m(r($,{class:"datail-btns"},{default:c((()=>[r($,{class:"btns-list"},{default:c((()=>[r($,{class:"btns-item",onClick:i[0]||(i[0]=k((t=>I.iconflag=!I.iconflag),["stop"]))},{default:c((()=>[m(r(A,{class:"iconfont icon-xihuan1"},null,512),[[u,I.iconflag]]),m(r(A,{class:"iconfont icon-xihuan"},null,512),[[u,!I.iconflag]])])),_:1}),r($,{class:"btns-item",onClick:k(T.Bootapp,["stop"])},{default:c((()=>[r(A,{class:"iconfont icon-icon_xinyong_xianxing_jijin-221"})])),_:1},8,["onClick"]),r($,{class:"btns-item",onClick:i[1]||(i[1]=k((t=>I.commentflag=!I.commentflag),["stop"]))},{default:c((()=>[r(A,{class:"iconfont icon-pinglun-"})])),_:1}),r($,{class:"btns-item",onClick:i[2]||(i[2]=k((t=>I.likeflag=!I.likeflag),["stop"]))},{default:c((()=>[r(A,{class:"iconfont icon-diandiandianshu"})])),_:1})])),_:1})])),_:1},512),[[u,I.geciFlag]])])),_:1},512),[[u,I.isShow]]),m(r($,{class:"dateil-like",onClick:i[4]||(i[4]=t=>I.likeflag=!1)},{default:c((()=>[r($,{class:"like-cont",catchtap:"stop"},{default:c((()=>[r($,{class:"like-head"},{default:c((()=>[p("喜欢这首歌的人也听 "),r(j,{class:"head-btn",onClick:T.topmscik},{default:c((()=>[r(A,{class:"iconfont iconbofang"}),p("一键收听")])),_:1},8,["onClick"])])),_:1}),(a(!0),g(f,null,h(I.simiList,(t=>(a(),l($,{onClick:i=>T.detailLikeList(t.id),class:"like-link",key:t.id},{default:c((()=>[r($,{class:"like-item"},{default:c((()=>[r($,{class:"like-img"},{default:c((()=>[t.album?(a(),l(S,{key:0,src:t.album.picUrl,mode:"widthFix"},null,8,["src"])):o("",!0)])),_:2},1024),r($,{class:"like-song"},{default:c((()=>[r($,null,{default:c((()=>[p(y(t.name),1)])),_:2},1024),r($,null,{default:c((()=>[t.privilege&&t.privilege.flag>60&&t.privilege.flag<70?(a(),l(S,{key:0,src:D,mode:"widthFix"})):o("",!0),t.privilege&&999e3===t.privilege.maxbr?(a(),l(S,{key:1,src:w,mode:"widthFix"})):o("",!0),r(A,null,{default:c((()=>[p(y(t.artists[0].name)+" - "+y(t.album.name),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),r(A,{class:"iconfont iconbofang"})])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1},512),[[u,I.likeflag]]),m(r($,{class:"dateil-comment"},{default:c((()=>[r($,{class:"comment-nav"},{default:c((()=>[r(A,{class:"iconfont iconzuojiantou-copy",onClick:i[5]||(i[5]=t=>I.commentflag=!I.commentflag)}),p("评论 ")])),_:1}),r($,{class:"comment-head"},{default:c((()=>[p("精彩评论")])),_:1}),r($,{class:"comment-list"},{default:c((()=>[(a(!0),g(f,null,h(I.commentList,((t,i)=>(a(),l($,{class:"comment-item",key:t.commentId},{default:c((()=>[r($,{class:"comment-img"},{default:c((()=>[t.user?(a(),l(S,{key:0,src:t.user.avatarUrl,mode:"widthFix"},null,8,["src"])):o("",!0)])),_:2},1024),r($,{class:"comment-cont"},{default:c((()=>[r($,{class:"title"}),r($,{class:"name"},{default:c((()=>[r($,{class:"comment-line"},{default:c((()=>[r($,{class:""},{default:c((()=>[p(y(t.user.nickname),1)])),_:2},1024),r($,{class:""},{default:c((()=>[p(y(new Date(t.time).getFullYear()+"年"+new Date(t.time).getMinutes()+"月"+new Date(t.time).getDate()+"日"),1)])),_:2},1024)])),_:2},1024),r($,{class:"comment-click"},{default:c((()=>[p(" 56027"),r(A,{class:"iconfont iconlike"})])),_:1})])),_:2},1024),r($,{class:"comment-text"},{default:c((()=>[p(y(t.content),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1},512),[[u,I.commentflag]]),m(r($,{class:"dateil-bottom"},{default:c((()=>[r($,{class:"bottom-area"},{default:c((()=>[r($,{class:"player-currentTime"},{default:c((()=>[p(y(I.slider.currentTime),1)])),_:1}),r(z,{class:"slider",min:"0",max:I.slider.endValue,value:I.slider.sliderValue,activeColor:"#ccc",backgroundColor:"#eee","block-size":"16",onChange:T.changeProgress},null,8,["max","value","onChange"]),r($,{class:"player-duration"},{default:c((()=>[p(y(I.slider.endTimer),1)])),_:1})])),_:1}),r($,{class:"bottom-btns"},{default:c((()=>[r($,{class:"btn",onClick:T.Bootapp},{default:c((()=>[r(A,{class:d(["iconfont",I.Circulationitem])},null,8,["class"])])),_:1},8,["onClick"]),r($,{class:"btn",onClick:i[6]||(i[6]=t=>T.Changesong(1))},{default:c((()=>[r(A,{class:"iconfont icon-shangyishoushangyige"})])),_:1}),r($,{class:"btn",onClick:T.clickmusck},{default:c((()=>[r(A,{class:d(["iconfont",I.musckflag?"icon-bofang":"icon-zanting"])},null,8,["class"])])),_:1},8,["onClick"]),r($,{class:"btn",onClick:i[7]||(i[7]=t=>T.Changesong(2))},{default:c((()=>[r(A,{class:"iconfont icon-xiayigexiayishou"})])),_:1}),r($,{class:"btn",onClick:i[8]||(i[8]=t=>I.playflag=!0)},{default:c((()=>[r(A,{class:"iconfont icon-24gl-playlistMusic2"})])),_:1})])),_:1})])),_:1},512),[[u,I.isShow]]),m(r($,{class:"playlist",onClick:i[9]||(i[9]=t=>I.playflag=!1)},{default:c((()=>[r($,{class:"playlist-cont",catchtap:"stop"},{default:c((()=>[r($,{class:"playlist-title"},{default:c((()=>[p(" 当前播放"),r(A,{class:"title-text"},{default:c((()=>[p("("+y(T.micskLength)+")",1)])),_:1})])),_:1}),r($,{class:"playlist-list"},{default:c((()=>[p(y()+" ",1),(a(!0),g(f,null,h(t.$store.state.micskss.tracks,((t,i)=>(a(),l($,{class:"playlist-item",onClick:i=>T.Changesong(3,t.id),key:t.id},{default:c((()=>[r($,{class:d(["playlist-text white",t.id===I.playActive?"active":""])},{default:c((()=>[r(A,{class:"iconfont icon-PCbofangye_paihangbang"}),p(y(t.name)+" ",1),r(A,null,{default:c((()=>[p("- "+y(t.ar[0].name),1)])),_:2},1024)])),_:2},1032,["class"]),r($,{onClick:k((i=>T.deleteSong(t.id)),["stop"]),class:"iconfont iconguanbi"},null,8,["onClick"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1},512),[[u,I.playflag]])])),_:1})}],["__scopeId","data-v-78f4b8fa"]]);export{$ as default};
